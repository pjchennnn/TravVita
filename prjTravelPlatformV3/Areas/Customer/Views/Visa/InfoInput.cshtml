@model prjTravelPlatformV3.Areas.Customer.ViewModels.Visa.VOrderViewModel

@section Styles {
    <style>
        body {
            background: #f7f6f3;
            font-family: sans-serif;
        }

        .date-picker {
            margin: 20px;
        }

        .date-picker {
            width: 100%;
            height: auto;
            max-height: 50px;
            background: white;
            position: relative;
            overflow: hidden;
            transition: all 0.3s 0s ease-in-out;
        }

            .date-picker .input {
                width: 100%;
                height: 50px;
                font-size: 0;
                cursor: pointer;
            }

                .date-picker .input .result, .date-picker .input button {
                    display: inline-block;
                    vertical-align: top;
                }

                .date-picker .input .result {
                    width: calc(100% - 50px);
                    height: 50px;
                    line-height: 50px;
                    font-size: 16px;
                    padding: 0 10px;
                    color: grey;
                    box-sizing: border-box;
                }

                .date-picker .input button {
                    width: 50px;
                    height: 50px;
                    background-color: #8392A7;
                    color: white;
                    line-height: 50px;
                    border: 0;
                    font-size: 18px;
                    padding: 0;
                }

                    .date-picker .input button:hover {
                        background-color: #68768A;
                    }

                    .date-picker .input button:focus {
                        outline: 0;
                    }

            .date-picker .calendar {
                position: relative;
                width: 100%;
                background: #fff;
                border-radius: 0px;
                overflow: hidden;
            }

            .date-picker .ui-datepicker-inline {
                position: relative;
                width: 100%;
            }

            .date-picker .ui-datepicker-header {
                height: 100%;
                line-height: 50px;
                background: #8392A7;
                color: #fff;
                margin-bottom: 10px;
            }

            .date-picker .ui-datepicker-prev, .date-picker .ui-datepicker-next {
                width: 20px;
                height: 20px;
                text-indent: 9999px;
                border: 2px solid #fff;
                border-radius: 100%;
                cursor: pointer;
                overflow: hidden;
                margin-top: 12px;
            }

            .date-picker .ui-datepicker-prev {
                float: left;
                margin-left: 12px;
            }

                .date-picker .ui-datepicker-prev:after {
                    transform: rotate(45deg);
                    margin: -43px 0px 0px 8px;
                }

            .date-picker .ui-datepicker-next {
                float: right;
                margin-right: 12px;
            }

                .date-picker .ui-datepicker-next:after {
                    transform: rotate(-135deg);
                    margin: -43px 0px 0px 6px;
                }

                .date-picker .ui-datepicker-prev:after, .date-picker .ui-datepicker-next:after {
                    content: '';
                    position: absolute;
                    display: block;
                    width: 4px;
                    height: 4px;
                    border-left: 2px solid #fff;
                    border-bottom: 2px solid #fff;
                }

                .date-picker .ui-datepicker-prev:hover, .date-picker .ui-datepicker-next:hover, .date-picker .ui-datepicker-prev:hover:after, .date-picker .ui-datepicker-next:hover:after {
                    border-color: #68768A;
                }

            .date-picker .ui-datepicker-title {
                text-align: center;
            }

            .date-picker .ui-datepicker-calendar {
                width: 100%;
                text-align: center;
            }

                .date-picker .ui-datepicker-calendar thead tr th span {
                    display: block;
                    width: 100%;
                    color: #8392A7;
                    margin-bottom: 5px;
                    font-size: 13px;
                }

            .date-picker .ui-state-default {
                display: block;
                text-decoration: none;
                color: #b5b5b5;
                line-height: 40px;
                font-size: 12px;
            }

                .date-picker .ui-state-default:hover {
                    background: rgba(0, 0, 0, 0.02);
                }

            .date-picker .ui-state-highlight {
                color: #68768A;
            }

            .date-picker .ui-state-active {
                color: #68768A;
                background-color: rgba(131, 146, 167, 0.12);
                font-weight: 600;
            }

            .date-picker .ui-datepicker-unselectable .ui-state-default {
                color: #eee;
                border: 2px solid transparent;
            }

            .date-picker.open {
                max-height: 400px;
            }

                .date-picker.open .input button {
                    background: #68768A;
                }

    </style>
}

<section class="pt-120">
    <div class="container ">

        <div class="row x-gap-40 y-gap-30 items-center">
            <div class="col-auto">
                <div class="d-flex items-center">
                    <div class="size-40 rounded-full flex-center bg-blue-1">
                        <i class="icon-check text-16 text-white"></i>
                    </div>
                    <div class="text-26 fw-500 ml-10" style="font-weight:bold;">選擇商品</div>
                </div>
            </div>

            <div class="col">
                <div class="w-full h-1 bg-border"></div>
            </div>

            <div class="col-auto">
                <div class="d-flex items-center">
                    <div class="size-40 rounded-full flex-center bg-blue-1">
                        <i class="icon-check text-16 text-white"></i>
                    </div>
                    <div class="text-26 fw-500 ml-10" style="font-weight:bold;">填寫資料</div>
                </div>
            </div>

            <div class="col">
                <div class="w-full h-1 bg-border"></div>
            </div>

            <div class="col-auto">
                <div class="d-flex items-center">
                    <div class="size-40 rounded-full flex-center bg-blue-1-05 text-blue-1 fw-500">3</div>
                    <div class="text-26 fw-500 ml-10" style="font-weight:bold;">成立訂單</div>
                </div>
            </div>
        </div>


    </div>
</section>



<form id="Create" class="overflow-auto">
    @Html.AntiForgeryToken()

    <section class="pt-40 layout-pb-md">
        <div class="container">


            <div class="row py-15 px-20 rounded-4 text-15 bg-blue-1-05">


                <div class="col-md-2">
                    <h2 class="text-26" style="font-weight:bold;">訂單摘要</h2>
                </div>


                <div class="col-md-4">
                    <div class="px-30 base-tr">
                        <div class="row y-gap-30 justify-between">
                            <div class="col">

                                <div class="text-16">
                                    本次訂購金額
                                    <div>
                                        總計
                                        <span class="text-20" style="font-weight:bold; color:red;">$</span>
                                        <span class="text-20" style="font-weight:bold; color:red;" id="Total">1,800</span>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>


                <div class="col-md-6">
                    <div class="accordion -simple row y-gap-20 js-accordion">
                        <div class="col-12">
                            <div class="accordion__item rounded-4 d-flex">
                                <div class="accordion__content" style="">
                                    <div class="row y-gap-10 items-center pt-10" id="productInfo" style="display:flex; border-top:solid lightgray 1px;">
                                        <div class="col-sm-auto" id="ProductPhoto">
                                            @* 國旗圖片 *@
                                        </div>

                                        <div class="col">
                                            <div class="row x-gap-20 items-end">
                                                <div class="col-auto">
                                                    <div class="lh-15"><span id="ProductName" class="text-18" style="font-weight:600;">@* 商品名稱 *@</span><span> X </span><span id="ProductCount">@* 商品數量 *@</span></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion__button d-flex items-center ml-20">
                                    <div class="button text-dark-1" style="font-weight:bold;">訂單明細</div>
                                    <div class="accordion__icon size-40 flex-center bg-light-2 rounded-full ml-10">
                                        <i class="icon-plus"></i>
                                        <i class="icon-minus"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


            </div>


            <div class="row py-15 px-20 mt-20 rounded-4 text-15 bg-blue-1-05">


                <div class="col-md-2">
                    <h2 class="text-26 mb-10" style="font-weight:bold;">取件方式</h2>
                </div>


                <div class="col-md-10">

                    <div class="px-30 base-tr">

                        <div class=" mt-10" id="PickupMethod">

                            <div class="d-flex justify-start align-items-center" id="PickupMethodRadioGroup">
                                <div class="form-radio d-flex items-center mr-10">
                                    <div class="radio">
                                        <input id="SelfPick" type="radio" name="delivery" onchange="d();">
                                        <div class="radio__mark">
                                            <div class="radio__icon"></div>
                                        </div>
                                    </div>
                                    <div class="text-14 lh-1 ml-10">自行取件</div>
                                </div>

                                <div class="form-radio d-flex items-center mr-10">
                                    <div class="radio">
                                        <input id="Delivery" type="radio" name="delivery" onchange="d();">
                                        <div class="radio__mark">
                                            <div class="radio__icon"></div>
                                        </div>
                                    </div>
                                    <div class="text-14 lh-1 ml-10">郵寄(加收費用40元)</div>
                                </div>
                                <div class="text-16" style="color:red; display:none;">請填寫地址</div>
                            </div>

                            <div class=" mt-10">
                                <div id="DeliveryNotice">
                                    <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
                                    <span>請至您的專屬客服門市進行取件，如欲更換取件門市請與您的客服聯繫。</span>
                                </div>
                                <div id="Address" style="display:none;">
                                    <div class="form-input ">
                                        <input asp-for="FForPickupOrDeliveryAddress" type="text" required="">
                                        <label class="lh-1 text-16 text-light-1">地址</label>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>


                    
                </div>
            </div>




            <div class="row py-15 px-20 mt-20 rounded-4 text-15 bg-blue-1-05">

                <div class="col-md-2">
                    <h2 class="text-26" style="font-weight:bold;">旅客資料</h2>
                    <button class="button -dark-1 px-30 h-50 bg-blue-1 text-white" data-x-click="flight-item-1" id="6" onclick="demo(event)">
                        Demo
                    </button>
                </div>

                <div class="col-md-10">
                    <div class="px-30 base-tr">
                        <div class="mt-15 mb-15" id="TravelerInfo">
                            @* 旅客資料 *@
                        </div>
                    </div>
                </div>

            </div>





            <div class="row py-15 px-20 mt-20 rounded-4 text-15 bg-blue-1-05">


                <div class="col-md-2">
                    <h2 class="text-26" style="font-weight:bold;">其他協助事項</h2>
                </div>


                <div class="col-md-5">
                    <div class="mt-15 mb-15">
                        <div class="px-30 base-tr">
                            
                            <div class="text-16 d-flex align-items-center justify-between">
                                <div>
                                    <span class="mr-10" style="font-weight:bold;">專屬客服</span>
                                    <span style="color:blue">鄭錦芬 02-25221588 #2620</span>
                                </div>
                                @* <button class="button -md -blue-1 bg-dark-4 text-white">更換客服</button> *@
                            </div>

                            <div class="px-20 py-20 mt-10 rounded-10 shadow-2">
                                服務時間：星期一～五08：30～18：00 星期六～日及國定假日08：30～17：00
                            </div>

                            <div class="mt-10">
                                <i class="fa fa-exclamation-circle" aria-hidden="true"></i><span> 若您希望指定其他客服(門市業務)，或欲使用實體的東南旅遊抵用券，請點選上方更換客服，選擇指定的人員</span>
                            </div>



                        </div>
                    </div>
                </div>



                <div class="col-md-5">
                    <div class="mt-15 mb-15">
                        <div class="px-30 base-tr">
                            
                            <div class="text-16 d-flex align-items-center justify-between">
                                <div>
                                    <span class="mr-10" style="font-weight:bold;">需要協助事項</span>
                                    <span class="text-14">我們將為您轉達，實際依辦理機關提供為準</span>
                                </div>
                            </div>


                            <div class="form-input">
                                <textarea asp-for="FMemo" class="form-control" required="" rows="4"></textarea>
                                <label class="lh-1 text-16 text-light-1">請填入需協助事項</label>
                            </div>


                        </div>
                    </div>
                </div>


            </div>




            <div class="row py-15 px-20 mt-20 rounded-4 text-15">
                <div class="col-md-12 d-flex justify-end">
                    <button type="button" class="button -md -dark-1 bg-yellow-1 text-dark-1 mr-30" onclick="sendFetchRequest()">成立訂單</button>
                </div>
            </div>



            
        </div>
    </section>

    <input asp-for="FId" class="form-control d-none" />

    <input asp-for="FProductId" class="form-control d-none" /> @* ok *@

    <input asp-for="FCustomerId" class="form-control d-none" />

    <input asp-for="FPrice" class="form-control d-none" /> @* ok *@

    <input asp-for="FQuantity" class="form-control d-none" /> @* ok *@

    <input asp-for="FDepartureDate" class="form-control d-none" /> @* ok *@

    <input asp-for="FInterviewReminder" class="form-control d-none" /> @* ok *@

    <input asp-for="FEvaluate" class="form-control d-none" /> @* ok *@

    <input asp-for="FStatusId" class="form-control d-none" /> @* ok *@

    <input asp-for="FCouponId" class="form-control d-none" /> @* ok *@


    <a asp-area="Customer" asp-controller="Visa" asp-action="OrderConfirm" id="OrderResultLink" style="display:none;"></a>
</form>


@section Scripts {

    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>

    <script>
        //OrderResultLink
        const OrderResultLink = document.getElementById('OrderResultLink');

        //購買數量
        var storedCount = localStorage.getItem('OrderCount');
        var parsedCount = JSON.parse(storedCount);
        const OrderCount = parsedCount.key;
        //商品id
        var storedId = localStorage.getItem('Id');
        var parsedId = JSON.parse(storedId);
        const id = parsedId.key;
        //預計出國日
        var storedDate = localStorage.getItem('DepartureDate');
        var parsedDate = JSON.parse(storedDate);
        const date = parsedDate.key;

        //依數量載入旅客填入框
        const TravelerInfo = document.getElementById('TravelerInfo');
        let travelerInfoHtml = `<div class="row y-gap-30 justify-between">
                                                <div class="st-alert-warning">
                                                    <i class="fa fa-exclamation-circle" aria-hidden="true"></i><span> 提醒您！若為台灣籍旅客，您的中文姓名曾經做過變更姓名，請務必提供您的戶籍謄本</span>
                                                </div>
                                            </div>`;
        for (let i = 1; i <= OrderCount; i++) {
            travelerInfoHtml += `<div id="traveler${i}" class="px-20 py-10 shadow-1 rounded-8 mt-10">
                                                <div class="text-20 d-flex align-items-center">
                                                    <span style="font-weight:bold;">旅客</span>
                                                    <div class="d-flex items-center ml-20">
                                                        <div class="form-checkbox ">
                                                            <input id="ForeignTog" type="checkbox" name="name" value=${i} onclick="ForeignToggle(this.value,event);">
                                                            <div class="form-checkbox__mark">
                                                                <div class="form-checkbox__icon icon-check"></div>
                                                            </div>
                                                        </div>
                                                        <div class="text-14 lh-12 ml-10">外國籍</div>
                                                    </div>
                                                </div>


                                                <div class="d-flex">

                                                    <div class="col-md-6">
                                                        <div class="text-16 pl-5 mr-10">
                                                            <span style="font-weight:bold;">護照姓名</span>
                                                        </div>


                                                        <div>
                                                            <div class="form-input mr-10">
                                                                <input name="travelerInfos" class="form-control" type="text" required="">
                                                                <label class="text-16 text-light-1">護照姓名</label>
                                                            </div>
                                                            
                                                        </div>
                                                    </div>


                                                    <div class="col-md-6" id="${i}">
                                                        <div class="text-16 pl-5 mr-10">
                                                            <span style="font-weight:bold;">中文姓名</span>
                                                        </div>


                                                        <div>
                                                            <div class="form-input mr-10">
                                                                <input name="travelerInfos" class="form-control" type="text" required="">
                                                                <label class="text-16 text-light-1">中文姓名</label>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>


                                                <div class="d-flex">



                                                    <div class="mt-5 col-md-6">
                                                        <div class="text-16 pl-5 mr-10">
                                                            <span style="font-weight:bold;">性別</span>
                                                        </div>


                                                        <div class="d-flex justify-start align-items-center mr-30 ml-15">
                                                            <div class="form-radio d-flex items-center mr-10">
                                                                <div class="radio">
                                                                    <input type="radio" name="name${i}" id=0 onchange="genderChange(this);">
                                                                    <input class="form-control d-none" name="travelerInfos">
                                                                    <div class="radio__mark">
                                                                        <div class="radio__icon"></div>
                                                                    </div>
                                                                </div>
                                                                <div class="text-14 lh-1 ml-10">小姐</div>
                                                            </div>

                                                            <div class="form-radio d-flex items-center mr-10">
                                                                <div class="radio">
                                                                    <input id=1 type="radio" name="name${i}" onchange="genderChange(this);">
                                                                    <div class="radio__mark">
                                                                        <div class="radio__icon"></div>
                                                                    </div>
                                                                </div>
                                                                <div class="text-14 lh-1 ml-10">先生</div>
                                                            </div>
                                                        </div>
                                                    </div>


                                                    <div class="date-picker col-md-6" style="width:40%;">
                                                        <div class="input">
                                                            <div class="result">生日 <span id="BirthDay${i}"></span><input name="travelerInfos" class="form-control d-none"></div>
                                                            <button><i class="fa fa-calendar"></i></button>
                                                        </div>
                                                        <div class="calendar"></div>
                                                    </div>



                                                </div>
                                            </div>`;
        }
        TravelerInfo.innerHTML = travelerInfoHtml;

        //外國籍旅客切換
        function ForeignToggle(v, e) {
            if (e.target.checked) {
                const nameInput = document.getElementById(v)
                nameInput.style.display = 'none';
                nameInput.lastElementChild.firstElementChild.firstElementChild.value = 'N/A';
            } else {
                const nameInput = document.getElementById(v)
                nameInput.style.display = 'block';
                nameInput.lastElementChild.firstElementChild.firstElementChild.value = '';
            }
        }


        //商品資料載入
        function loadProduct() {
            var CustomerId = @ViewBag.CustomerId;
            const Total = document.getElementById('Total');
            const ProductPhoto = document.getElementById('ProductPhoto');
            const ProductName = document.getElementById('ProductName');
            const ProductCount = document.getElementById('ProductCount');
            const PickupMethod = document.getElementById('PickupMethod');


            Total.innerText = (Product.價格 * OrderCount).toLocaleString();
            ProductPhoto.innerHTML = `<img class="size-40" src="/VCountry/${Product.國家}.png" alt="image" style="border-radius: 100%;">`;
            ProductName.innerText = Product.商品名稱;
            ProductCount.innerText = OrderCount;
            if (!Product.實體or電子簽) { PickupMethod.innerHTML = `<div class="text-16 lh-1 ml-10">電子簽證</div>`; }
            FQuantity.value = Number(OrderCount);
            FDepartureDate.value = date;
            FProductId.value = id;
            FPrice.value = Product.價格;
            //FInterviewReminder.value = null;
            FEvaluate.value = 0;
            FStatusId.value = 1;
            FCouponId.value = 16;
            //FForPickupOrDeliveryAddress.value = null;
            FId.value = 0;
            FCustomerId.value = CustomerId;
        }


        //ajax叫商品資料進來
        let Product = {};
        (async () => {
            try {
                const response = await fetch(`@Url.Content("~/Customer/Visa/VProductById")?Id=${id}`)
                if (!response.ok) {
                    console.log(response.status);
                    throw new Error(`${response.status}`);
                }
                const data = await response.json();
                Product = data;
                loadProduct();
            }
            catch (error) {
                console.log(`${error.message}`);
                console.log('fetchFail')
                return false;
            }
        })();

    </script>



    
    <script>
        //datepicker
        $(function () {
            $(".calendar").datepicker({
                dateFormat: 'yy/m/d',
                firstDay: 7,
                changeYear: true, // 允許選擇年份
                yearRange: '1920:2020', // 允許選擇的年份範圍
                defaultDate: new Date(2000, 1, 1) // 2024年1月1日為起始日期
            });

            $(document).on('click', '.date-picker .input', function (e) {
                var $me = $(this),
                    $parent = $me.parents('.date-picker');
                $parent.toggleClass('open');
            });


            $(".calendar").on("change", function () {
                var $me = $(this),
                    $selected = $me.val(),
                    $parent = $me.parents('.date-picker');
                $parent.find('.result').children('span').html($selected);
                $parent.find('.result').children('input').val($selected);
            });
        });
    </script>

    <script>
        //取件方式toggle
        function d() {
            const DeliveryNotice = document.getElementById('DeliveryNotice');
            const Address = document.getElementById('Address');
            const Delivery = document.getElementById('Delivery');
            if (Delivery.checked) {
                Address.style.display = 'block';
                DeliveryNotice.style.display = 'none';
                FForPickupOrDeliveryAddress.value = '';
            } else {
                Address.style.display = 'none';
                DeliveryNotice.style.display = 'block';
                FForPickupOrDeliveryAddress.value = 'S';
            }
           
        }

        //性別toggle
        function genderChange(t) {
            if (t.nextElementSibling.name === 'travelerInfos') {
                t.nextElementSibling.value = false;
            }
            else {
                t.parentNode.parentNode.previousElementSibling.firstElementChild.firstElementChild.nextElementSibling.value = true;
            }
        }


        //demobtn
        function demo(event) {
            event.preventDefault();
            FForPickupOrDeliveryAddress.value = 'S';
            document.getElementById('SelfPick').click();
            document.getElementById('0').click();
            const travelerInfos = document.getElementsByName('travelerInfos');
            travelerInfos[0].value = 'Zhao, LU LU';
            travelerInfos[1].value = '趙露露';
            travelerInfos[2].value = false;
            travelerInfos[3].value = '2000/3/29';
            document.getElementById('BirthDay1').innerText = '2000/3/29';
            FMemo.value = '請盡快，謝謝!'
        }


    </script>




    <script>
        function findParentWithClass(element, className) {
            // 如果当前元素为空或者是根元素，则返回null
            if (!element || !element.parentNode) {
                return null;
            }

            // 如果当前元素的父元素具有指定的类名，则返回该父元素
            if (element.parentNode.classList.contains(className)) {
                return element.parentNode;
            }

            // 否则，递归调用该函数，查找父元素的父元素
            return findParentWithClass(element.parentNode, className);
        }

    

        //發出訂單ajax


        //根據傳入的action name呼叫對應的api
        async function sendFetchRequest() {
            let deliveryError = 0;
            let travelerError = 0;
            let errorCount = 0;
            //先檢查有無填寫資料
            if (document.getElementsByName('delivery').length > 0) {
                const Delivery = document.getElementById('Delivery');
                const SelfPick = document.getElementById('SelfPick');
                if (!Delivery.checked && !SelfPick.checked) {
                    const PickupMethodRadioGroup = document.getElementById('PickupMethodRadioGroup');
                    PickupMethodRadioGroup.innerHTML += `<span class="text-16" style="color:red;">請勾選取件方式</span>`;
                    deliveryError++;
                    errorCount++;
                }
            }

            const travelerInfosList = document.getElementsByName('travelerInfos');
            for (var travelerInfos of travelerInfosList) {
                if (!travelerInfos.value) {
                    var parentElement = findParentWithClass(travelerInfos, "shadow-1");
                    if (!parentElement.firstElementChild.innerHTML.includes('請詳填並選取旅客資料')) {
                        parentElement.firstElementChild.innerHTML += `<span class="text-16 ml-20" style="color:red;">請詳填並選取旅客資料</span>`;
                    }
                    travelerError++;
                    errorCount++;
                }
            }

            document.querySelectorAll('.shadow-1').forEach(function (shadowElement) {
                let inputerror = 0;
                shadowElement.querySelectorAll('input[name="travelerInfos"]').forEach(function (inputElement) {
                    if (inputElement.value.trim() === '') {
                        inputerror++;
                    }
                });
                if (inputerror === 0) {
                    if (shadowElement.firstElementChild.innerHTML.includes(`<span class="text-16 ml-20" style="color:red;">請詳填並選取旅客資料</span>`)) {
                        shadowElement.firstElementChild.removeChild(shadowElement.firstElementChild.lastElementChild);
                    }
                }
            });



            if (deliveryError === 0) {
                const PickupMethodRadioGroup = document.getElementById('PickupMethodRadioGroup');
                if (PickupMethodRadioGroup.innerHTML.includes(`<span class="text-16" style="color:red;">請勾選取件方式</span>`)) {
                    PickupMethodRadioGroup.removeChild(PickupMethodRadioGroup.lastElementChild);
                }
            }

            if (errorCount > 0) {
                return;
            }


            
            //目前的form id的DOM元素
            const formIdDOM = document.getElementById('Create')
            //新增form data物件
            const formData = new FormData(formIdDOM);

            //formData內容監看
            var formDataEntries = formData.entries();
            for (var pair of formDataEntries) {
                console.log(pair[0] + ', ' + pair[1]);
            }

            //取得防偽標籤
            const token = document.querySelector('input[name="__RequestVerificationToken"]').value;
            try {
                const res = await fetch(`@Url.Content("~/Customer/Visa/Create")`, {
                    headers: {
                        'RequestVerificationToken': token
                    },
                    body: formData,
                    method: 'POST'
                });
                if (!res.ok) {
                    throw new Error(`${res.status}`)
                }
                const data = await res.json();

                if (data.success) {
                    console.log(data);
                    
                    //前往OrderConfirm
                    OrderResultLink.click();

                } else {
                    console.log(data.errors)
                    //依自己的form增加需要驗證的欄位(驗證規則在partial view中)
                    const errortravelerInfos = document.querySelector(`[data-valmsg-for="travelerInfos"]`);
                    
                    if (errortravelerInfos) {
                        errortravelerInfos.textContent = data.errors.travelerInfos[0];
                    }
                }
            } catch (error) {
                // Swal.fire({
                //     title: "error",
                //     text: error.message,
                //     icon: "error"
                // });
                console.log(error.message);
            }
        }
    </script>
}