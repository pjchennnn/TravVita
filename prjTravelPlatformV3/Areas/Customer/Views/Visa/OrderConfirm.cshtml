@using System.Security.Claims
@inject IHttpContextAccessor _httpContextAccessor





<section class="pt-120">
    <div class="container ">

        <div class="row x-gap-40 y-gap-30 items-center">
            <div class="col-auto">
                <div class="d-flex items-center">
                    <div class="size-40 rounded-full flex-center bg-blue-1">
                        <i class="icon-check text-16 text-white"></i>
                    </div>
                    <div class="text-26 fw-500 ml-10" style="font-weight:bold;">選擇商品</div>
                </div>
            </div>

            <div class="col">
                <div class="w-full h-1 bg-border"></div>
            </div>

            <div class="col-auto">
                <div class="d-flex items-center">
                    <div class="size-40 rounded-full flex-center bg-blue-1">
                        <i class="icon-check text-16 text-white"></i>
                    </div>
                    <div class="text-26 fw-500 ml-10" style="font-weight:bold;">填寫資料</div>
                </div>
            </div>

            <div class="col">
                <div class="w-full h-1 bg-border"></div>
            </div>

            <div class="col-auto">
                <div class="d-flex items-center">
                    <div class="size-40 rounded-full flex-center bg-blue-1">
                        <i class="icon-check text-16 text-white"></i>
                    </div>
                    <div class="text-26 fw-500 ml-10" style="font-weight:bold;">成立訂單</div>
                </div>
            </div>
        </div>


    </div>
</section>


<section class="pt-40 layout-pb-md">
    <div class="container">
        <div class="row py-15 px-20 rounded-4 text-15 bg-blue-1-05">
            <div class="d-flex align-itmes-center">
                <div class="col-md-7 d-flex" style="align-items:center;">
                    <div class="base-tr">
                        <div class="row y-gap-30 justify-between">
                            <div class="d-flex" style="align-items:center;">
                                <div class="size-40 rounded-full flex-center bg-blue-1">
                                    <i class="icon-check text-16 text-white"></i>
                                </div>
                                <div class="ml-120">
                                    <div class="text-16 fw-500">您的訂單已成立，感謝您的訂購!</div>
                                    <div style="font-weight:bold;">
                                        訂單編號
                                        <span id="ProductId"></span>
                                        <span> ，訂單總計</span>
                                        <span id="Total1" style="font-weight:bold; color:red;">@* 總價1 *@</span>
                                    </div>
                                    <div>
                                        <span>請在</span>
                                        <span id="EndTime" style="color:red;">@* 付款期限 *@</span>
                                        <span>前完成付款</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="accordion -simple row y-gap-20 js-accordion">
                        <div class="px-10 py-10 mt-10 mb-10 mr-10 ml-10 rounded-10 shadow-1">
                            <div class="text-16 d-flex align-items-center justify-between">
                                <div>
                                    <span class="mr-10" style="font-weight:bold;">專屬客服</span>
                                    <span style="color:blue">鄭錦芬 02-25221588 #2620</span>
                                </div>
                            </div>
                            服務時間：星期一～五08：30～18：00 星期六～日及國定假日08：30～17：00
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="row py-15 px-20 mt-20 rounded-4 text-15 bg-blue-1-05">
            <div class="col-md-2">
                <h2 class="text-26 mb-10" style="font-weight:bold;">訂單明細</h2>
            </div>
            <div class="col-md-5">
                <div class="px-30 base-tr">
                    <div class=" mt-10">
                        <div class="row y-gap-10 items-center">
                            <div class="lh-15 text-20 px-15 py-10" style="font-weight:bold; border-bottom:solid lightgray 1px;">商品資訊</div>
                            <div class="col mt-20">
                                <div class="row y-gap-10 items-center">
                                    <div class="col-sm-auto" id="ProductPhoto">
                                        @* 國旗圖片 *@
                                    </div>
                                    <div class="col">
                                        <div class="row x-gap-20 items-end">
                                            <div class="col-auto">
                                                <div id="ProductName" class="lh-15" style="font-weight:600;">@* 商品名稱 *@</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-auto">
                                        <div class="row x-gap-10 y-gap-10 pt-20">
                                            <div class="col-auto">
                                                <div id="ProductIsEntity" class=" rounded-100 py-5 px-20 text-14 lh-14 bg-info-1">@* 實體or電子 *@</div>
                                            </div>
                                            <div class="col-auto">
                                                <div id="ProductValid" class=" rounded-100 py-5 px-20 text-14 lh-14 bg-info-1">@* 效期 *@</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col text-center mt-3">
                                    <div class="flightLine">
                                        <div></div>
                                        <div></div>
                                    </div>
                                </div>
                                <div class="row y-gap-10 items-center pt-20">
                                    <div class="col">
                                        <div class="row x-gap-20 items-end">
                                            <div class="col-auto">
                                                <div class="d-flex">
                                                    <div class="lh-15 mr-15 ml-15" style="font-weight:bold;">機關辦理天數: </div>
                                                    <div id="ProductProcessing" class="lh-15">@* 辦理天數 *@</div>
                                                    <div class="lh-15" style="color:red;">(代辦約再加4個工作天且不含假日)</div>
                                                </div>
                                            </div>
                                            <div class="col-auto">
                                                <div class="d-flex">
                                                    <div class="lh-15 mr-15 ml-15" style="font-weight:bold; margin-left:16px;">可停留天數: </div>
                                                    <div id="ProductStayLength" class="lh-15 ">@* 可停留天數 *@</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="col-md-5">
                <div class="px-30 base-tr">
                    <div class=" mt-10">
                        <div class="y-gap-30">
                            <div class="lh-15 text-20 px-15" style="font-weight:bold; border-bottom:solid lightgray 1px;">金額明細</div><br />
                            <div class="px-15" style="border-bottom:solid black 2px;">
                                <div class="d-flex justify-between align-items-center">
                                    <div id="ProductName2" class="lh-15 text-20" style="font-weight:bold;">@* 品名2 *@</div>
                                    <div id="ProductPrice1" class="lh-15 text-20" style="font-weight:bold;">@* 單價1 *@</div>
                                </div>
                                <span id="ProductPrice2">@* 單價2 *@</span><span id="OrderCount">@* 購買數量 *@</span>
                            </div>
                            <div class="d-flex justify-between px-15">
                                <div class="currency pull-left">幣別:新台幣</div>
                                <div class="d-flex align-items-center">
                                    <span style="margin-right:16px;">總計</span>
                                    <p id="Total2" class="text-24" style="font-weight:bold; color:red;">@* 總價2 *@</p>
                                </div>
                            </div>
                            <div class="d-flex justify-end mb-15" style="padding:0;">
                                <button class="button -md -dark-1 bg-yellow-1 text-dark-1" onclick="checkOrder(this)">查看個人資訊</button>
                                <a class="d-none" asp-area="Customer" asp-controller="Userprofile" asp-action="Index"></a>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>


        @* <div class="row py-15 px-20 mt-20 rounded-4 text-15 bg-blue-1-05">


            <div class="col-md-2">
                <h2 class="text-26" style="font-weight:bold;">獨享好禮</h2>
            </div>


            <div class="col-md-7">
                <div class="mt-15 mb-15">
                    <div class="px-30 base-tr">

                        <div class="px-20 py-20 mt-10 rounded-10 shadow-1">
                            高鐵1+1超省方案<br />
                            (廣告圖片)
                        </div>

                    </div>
                </div>
            </div>



            <div class="col-md-3">
                <div class="mt-15 mb-15">
                    <div class="px-30 base-tr d-flex justify-end">

                        <button class="button -md -outline-blue-1 text-blue-1">瞭解詳情</button>


                    </div>
                </div>
            </div>


        </div> *@


    </div>
</section>




@section Scripts {
    <script>
        //購買數量
        var storedCount = localStorage.getItem('OrderCount');
        var parsedCount = JSON.parse(storedCount);
        const OrderCount = parsedCount.key;
        //商品id
        var storedId = localStorage.getItem('Id');
        var parsedId = JSON.parse(storedId);
        const id = parsedId.key;
        //預計出國日
        var storedDate = localStorage.getItem('DepartureDate');
        var parsedDate = JSON.parse(storedDate);
        const date = parsedDate.key;





        function loadOrder() {
            const ProductId = document.getElementById('ProductId');
            const Total1 = document.getElementById('Total1');
            const EndTime = document.getElementById('EndTime');
            const OrderCount = document.getElementById('OrderCount');
            const Total2 = document.getElementById('Total2');


            //得到時間
            var currentDate = new Date();
            currentDate.setDate(currentDate.getDate() + 14);
            var formattedDateTime = currentDate.toLocaleString().slice(0, 19).replace("T", " ");
            Total1.innerText = '$' + (Order.總價).toLocaleString();
            EndTime.innerText = formattedDateTime;

            ProductId.innerText = Order.編號;
            OrderCount.innerText = ' X ' + Order.數量;
            Total2.innerText = '$' + (Order.總價).toLocaleString();
        }


        function loadProduct() {
            const ProductPhoto = document.getElementById('ProductPhoto');
            const ProductName = document.getElementById('ProductName');
            const ProductIsEntity = document.getElementById('ProductIsEntity');
            const ProductValid = document.getElementById('ProductValid');
            const ProductProcessing = document.getElementById('ProductProcessing');
            const ProductStayLength = document.getElementById('ProductStayLength');
            const ProductName2 = document.getElementById('ProductName2');
            const ProductPrice1 = document.getElementById('ProductPrice1');
            const ProductPrice2 = document.getElementById('ProductPrice2');
            

            ProductPhoto.innerHTML = `<img class="size-40" src="/VCountry/${Product.國家}.png" alt="image" style="border-radius: 100%;">`;
            ProductName.innerText = Product.商品名稱;
            if (Product.實體or電子簽) { ProductIsEntity.innerText = '實體簽證' } else { ProductIsEntity.innerText = '電子簽證' }
            ProductValid.innerText = Product.效期 + '效期';
            ProductProcessing.innerText = Product.辦理耗時天數 + '個工作天';
            ProductStayLength.innerText = Product.可留天數;
            ProductName2.innerText = Product.商品名稱;
            ProductPrice1.innerText = '$' + (Product.價格).toLocaleString();
            ProductPrice2.innerText = '$' + (Product.價格).toLocaleString();
        }





        //ajax叫訂單資料進來
        let Order = {};
        (async () => {
            try {
                const response = await fetch(`@Url.Content("~/Customer/Visa/VOrderById")`)
                if (!response.ok) {
                    console.log(response.status);
                    throw new Error(`${response.status}`);
                }
                const data = await response.json();
                Order = data;
                loadOrder();
            }
            catch (error) {
                console.log(`${error.message}`);
                console.log('fetchFail')
                return false;
            }
        })();

        //叫商品資料
        let Product = {};
        (async () => {
            try {
                const response = await fetch(`@Url.Content("~/Customer/Visa/VProductById")?Id=${id}`)
                if (!response.ok) {
                    console.log(response.status);
                    throw new Error(`${response.status}`);
                }
                const data = await response.json();
                Product = data;
                loadProduct();
            }
            catch (error) {
                console.log(`${error.message}`);
                console.log('fetchFail')
                return false;
            }
        })();


        function checkOrder(t) {
            t.nextElementSibling.click();
        }


    </script>
}