@section Styles{
    <link href="~/css/flight/cssforflightmodal.css" rel="stylesheet" />
    <style>

    </style>
}

<body>
    @*   <div class="preloader js-preloader">
    <div class="preloader__wrap">
    <div class="preloader__icon">
    <svg width="38" height="37" viewBox="0 0 38 37" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g clip-path="url(#clip0_1_41)">
    <path d="M32.9675 13.9422C32.9675 6.25436 26.7129 0 19.0251 0C11.3372 0 5.08289 6.25436 5.08289 13.9422C5.08289 17.1322 7.32025 21.6568 11.7327 27.3906C13.0538 29.1071 14.3656 30.6662 15.4621 31.9166V35.8212C15.4621 36.4279 15.9539 36.92 16.561 36.92H21.4895C22.0965 36.92 22.5883 36.4279 22.5883 35.8212V31.9166C23.6849 30.6662 24.9966 29.1071 26.3177 27.3906C30.7302 21.6568 32.9675 17.1322 32.9675 13.9422V13.9422ZM30.7699 13.9422C30.7699 16.9956 27.9286 21.6204 24.8175 25.7245H23.4375C25.1039 20.7174 25.9484 16.7575 25.9484 13.9422C25.9484 10.3587 25.3079 6.97207 24.1445 4.40684C23.9229 3.91841 23.6857 3.46886 23.4347 3.05761C27.732 4.80457 30.7699 9.02494 30.7699 13.9422ZM20.3906 34.7224H17.6598V32.5991H20.3906V34.7224ZM21.0007 30.4014H17.0587C16.4167 29.6679 15.7024 28.8305 14.9602 27.9224H16.1398C16.1429 27.9224 16.146 27.9227 16.1489 27.9227C16.152 27.9227 23.0902 27.9224 23.0902 27.9224C22.3725 28.8049 21.6658 29.6398 21.0007 30.4014ZM19.0251 2.19765C20.1084 2.19765 21.2447 3.33365 22.1429 5.3144C23.1798 7.60078 23.7508 10.6649 23.7508 13.9422C23.7508 16.6099 22.8415 20.6748 21.1185 25.7245H16.9322C15.2086 20.6743 14.2994 16.6108 14.2994 13.9422C14.2994 10.6649 14.8706 7.60078 15.9075 5.3144C16.8057 3.33365 17.942 2.19765 19.0251 2.19765V2.19765ZM7.28053 13.9422C7.28053 9.02494 10.3184 4.80457 14.6157 3.05761C14.3647 3.46886 14.1273 3.91841 13.9059 4.40684C12.7425 6.97207 12.102 10.3587 12.102 13.9422C12.102 16.7584 12.9462 20.7176 14.6126 25.7245H13.2259C9.33565 20.6126 7.28053 16.5429 7.28053 13.9422Z" fill="#3554D1" />
    </g>

    <defs>
    <clipPath id="clip0_1_41">
    <rect width="36.92" height="36.92" fill="white" transform="translate(0.540039)" />
    </clipPath>
    </defs>
    </svg>
    </div>
    </div>

    <div class="preloader__title">GoTrip</div>
    </div> *@

    <main>
        <div class="masthead__bg" style="position: relative; ">
            <img src="~/img/airline/airplane.png" style="filter: brightness(55%); width: 100%; height:320px;" />
            <div class="text-center" style="position: absolute; top:50%; left:50%; transform:translate(-50%, -50%);">
                <h1 class="text-30 fw-600 text-white">尋找機票</h1>
            </div>
        </div>
        @* <section class="pt-20 bg-light-2 ">
            <div>
                <button id="btnMap" class="button -dark-1 h-60 px-35 col-12 rounded-100 bg-blue-1 text-white m-auto" style="width:500px">台灣天氣地圖 - 各縣市一周天氣預測</button>
            </div>
        </section>
        @* 彈跳視窗 *@
        <!-- Modal -->
        @* <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" style="width:600px">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title text-dark-1" id="exampleModalLabel">台灣天氣地圖 - 各縣市一周天氣預測</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="modalBody">
                        <iframe id="mapFrame" src="" width="100%" height="600px" frameborder="0"></iframe>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div> *@

        <section data-anim-wrap class="pt-40 pb-40 bg-light-2">
            <div class="container-1500">
                <div class="row">
                    <div class="col-12">
                        <div class="masthead__content">

                            <div class="mainSearch -col-4 -w-1070 bg-white shadow-1 pr-20 py-10 lg:px-20 lg:pt-5 lg:pb-20" style="margin:0 auto; border-radius:15px">
                                <div class="row y-gap-20 items-center pt-10 px-40">
                                    <div class="col-auto">

                                        <div class="dropdown js-dropdown js-return-active">
                                            <div class="dropdown__button d-flex items-center  text-15" data-el-toggle=".js-return-toggle" data-el-toggle-active=".js-return-active">
                                                <span id="optTripType" class="js-dropdown-title">來回</span>
                                                <i class="icon icon-chevron-sm-down text-7 ml-10"></i>
                                            </div>

                                            <div class="toggle-element -dropdown  js-click-dropdown js-return-toggle">
                                                <div class="text-14 y-gap-15 js-dropdown-list">

                                                    <div><a href="#" class="d-block js-dropdown-link">來回</a></div>

                                                    <div><a href="#" class="d-block js-dropdown-link">單程</a></div>

                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-auto">

                                        <div class="dropdown js-dropdown js-economy-active">
                                            <div class="dropdown__button d-flex items-center  text-15" data-el-toggle=".js-economy-toggle" data-el-toggle-active=".js-economy-active">
                                                <span id="optClass" class="js-dropdown-title">所有艙等</span>
                                                <i class="icon icon-chevron-sm-down text-7 ml-10"></i>
                                            </div>

                                            <div class="toggle-element -dropdown  js-click-dropdown js-economy-toggle">
                                                <div class="text-14 y-gap-15 js-dropdown-list">
                                                    <div><a href="#" class="d-block js-dropdown-link">所有艙等</a></div>

                                                    <div><a href="#" class="d-block js-dropdown-link">經濟艙</a></div>

                                                    <div><a href="#" class="d-block js-dropdown-link">豪華經濟艙</a></div>

                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                </div>
                                <div class="button-grid items-center m-3">

                                    <div class="searchMenu-loc px-24 lg:py-20 lg:px-0 js-form-dd js-liverSearch">

                                        <div data-x-dd-click="searchMenu-loc">
                                            <h4 class="text-15 fw-500 ls-2 lh-16">起飛地</h4>

                                            <div class="text-15 text-light-1 ls-2 lh-16">
                                                <input id="txtDeparture" autocomplete="off" type="search" placeholder="機場" class="js-search js-dd-focus">
                                                <div id="alertMsgDeparture" class="validation-message" style="color:red"></div>
                                            </div>
                                        </div>
                                        <div class="searchMenu-loc__field shadow-2 js-popup-window" data-x-dd="searchMenu-loc" data-x-dd-toggle="-is-active">
                                            <div id="optDeparture" class="bg-white px-30 py-30 sm:px-0 sm:py-15 rounded-4">
                                                <div class="y-gap-5 js-results">
                                                    @* 起飛地選項 *@
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="searchMenu-loc px-24 lg:py-20 lg:px-0 js-form-dd js-liverSearch">

                                        <div data-x-dd-click="searchMenu-loc">
                                            <h4 class="text-15 fw-500 ls-2 lh-16">降落地</h4>

                                            <div class="text-15 text-light-1 ls-2 lh-16">
                                                <input id="txtDestination" autocomplete="off" type="search" placeholder="機場" class="js-search js-dd-focus">
                                                <div id="alertMsgDestination" class="validation-message" style="color:red"></div>
                                            </div>
                                        </div>
                                        <div class="searchMenu-loc__field shadow-2 js-popup-window" data-x-dd="searchMenu-loc" data-x-dd-toggle="-is-active">
                                            <div class="bg-white px-30 py-30 sm:px-0 sm:py-15 rounded-4">
                                                <div id="optDestination" class="y-gap-5 js-results">
                                                    @* 降落地選項 *@
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="searchMenu-date px-24 lg:py-20 lg:px-0 js-form-dd js-calendar js-calendar-el">

                                        <div data-x-dd-click="searchMenu-date">
                                            <h4 class="text-15 fw-500 ls-2 lh-16">日期</h4>

                                            <div class="capitalize text-15 text-light-1 ls-2 lh-16">
                                                <span class="js-first-date">請選擇日期</span>

                                                <span class="js-last-date"></span>
                                                <div id="alertMsgDate" class="validation-message" style="color:red"></div>
                                            </div>
                                        </div>

                                        <div class="searchMenu-date__field shadow-2" data-x-dd="searchMenu-date" data-x-dd-toggle="-is-active">
                                            <div class="bg-white px-30 py-30 rounded-4">
                                                <div class="elCalendar js-calendar-el-calendar">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="searchMenu-guests px-24 lg:py-20 lg:px-0 js-form-dd js-form-counters m-3">

                                        <div data-x-dd-click="searchMenu-guests">
                                            <h4 class="text-15 fw-500 ls-2 lh-16">旅客</h4>

                                            <div class="text-15 text-light-1 ls-2 lh-16">
                                                <span class="js-count-adult">1</span> 成人
                                                -
                                                <span class="js-count-child">0</span> 孩童
                                                -
                                                <span class="js-count-baby">0</span> 幼兒
                                                <div id="alertMsgTicketQty" class="validation-message" style="color:red"></div>
                                            </div>
                                        </div>
                                        <div class="searchMenu-guests__field shadow-2" data-x-dd="searchMenu-guests" data-x-dd-toggle="-is-active">
                                            <div class="bg-white px-30 py-30 rounded-4">
                                                <div class="row y-gap-10 justify-between items-center">
                                                    <div class="col-auto">
                                                        <div class="text-15 fw-500">成人</div>
                                                    </div>

                                                    <div class="col-auto">
                                                        <div class="d-flex items-center js-counter" data-value-change=".js-count-adult">
                                                            <button class="button -outline-blue-1 text-blue-1 size-38 rounded-4 js-down">
                                                                <i class="icon-minus text-12"></i>
                                                            </button>

                                                            <div class="flex-center size-20 ml-15 mr-15">
                                                                <div class="text-15 js-count">1</div>
                                                            </div>

                                                            <button class="button -outline-blue-1 text-blue-1 size-38 rounded-4 js-up">
                                                                <i class="icon-plus text-12"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="border-top-light mt-24 mb-24"></div>

                                                <div class="row y-gap-10 justify-between items-center">
                                                    <div class="col-auto">
                                                        <div class="text-15 lh-12 fw-500">孩童</div>
                                                        <div class="text-13 lh-12 text-light-1 mt-2">Ages 2 - 12</div>
                                                    </div>

                                                    <div class="col-auto">
                                                        <div class="d-flex items-center js-counter" data-value-change=".js-count-child">
                                                            <button class="button -outline-blue-1 text-blue-1 size-38 rounded-4 js-down">
                                                                <i class="icon-minus text-12"></i>
                                                            </button>

                                                            <div class="flex-center size-20 ml-15 mr-15">
                                                                <div class="text-15 js-count">0</div>
                                                            </div>

                                                            <button class="button -outline-blue-1 text-blue-1 size-38 rounded-4 js-up">
                                                                <i class="icon-plus text-12"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="border-top-light mt-24 mb-24"></div>

                                                <div class="row y-gap-10 justify-between items-center">
                                                    <div class="col-auto">
                                                        <div class="text-15 lh-12 fw-500">幼兒</div>
                                                        <div class="text-13 lh-12 text-light-1 mt-2">Ages 0 - 2</div>
                                                    </div>

                                                    <div class="col-auto">
                                                        <div class="d-flex items-center js-counter" data-value-change=".js-count-baby">
                                                            <button class="button -outline-blue-1 text-blue-1 size-38 rounded-4 js-down">
                                                                <i class="icon-minus text-12"></i>
                                                            </button>

                                                            <div class="flex-center size-20 ml-15 mr-15">
                                                                <div class="text-15 js-count">0</div>
                                                            </div>

                                                            <button class="button -outline-blue-1 text-blue-1 size-38 rounded-4 js-up">
                                                                <i class="icon-plus text-12"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="button-item">
                                        <button id="btnSearch" class="mainSearch__submit button -dark-1 h-60 px-35 col-12 rounded-100 bg-blue-1 text-white" style="width:150px">
                                            <i class="icon-search text-20 mr-10"></i>
                                            搜尋
                                        </button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </section>

        @* 天氣地圖 *@
        <section data-anim-wrap class="section-bg pt-80 pb-80 md:pt-40 md:pb-40">

            <div data-anim-child="fade delay-1" class="section-bg__item -w-1500 rounded-4 bg-white"></div>

            <div class="container">
                <div class="sectionTitle -md">
                    <h2 class="sectionTitle__title">安排行程前，先確認一下天氣吧！</h2>
                </div>
                <div class="row y-gap-30 justify-center sm:pt-20">
                    <div class="col-xl-12 col-lg-10">
                        <div class="accordion -simple row y-gap-20 js-accordion pt-10">

                            <div class="col-12">
                                <div class="accordion__item px-20 py-20 rounded-4" style="background-color:#C4E1E1">
                                    <div class="accordion__button d-flex items-center">
                                        <div class="accordion__icon size-40 flex-center bg-light-2 rounded-full mr-20">
                                            <i class="icon-plus"></i>
                                            <i class="icon-minus"></i>
                                        </div>

                                        <div class="button text-dark-1 lh-15 fw-500">開啟地圖</div>
                                    </div>

                                    <div class="accordion__content">
                                        <div class="pt-20 pl-60">
                                            @* 內文 *@
                                            @* weather map *@
                                            <div class="row y-gap-30 items-center justify-between">
                                                <div data-anim-child="slide-up delay-2" class="col-xl-5 col-lg-6">
                                                    <h2 class="text-30 lh-15">台灣天氣預報地圖</h2>
                                                    <p class="text-dark-1 pr-40 lg:pr-0 mt-15 sm:mt-5">將滑鼠移至想查詢的縣市位置，即可看到未來36小時的天氣預報。<br></br>資料來源：中央氣象局</p>

                                                    <div class="row y-gap-20 items-center pt-30 sm:pt-10">
                                                        <div class="col-auto">
                                                            <a href="#">
                                                                <div  class="d-flex items-center px-20 py-10 rounded-8 border-white-15 text-white bg-dark-1">
                                                                    @* <div class="icon-apple text-24"></div> *@
                                                                    <i class="icon-tickets text-25 mb-10"></i>
                                                                    <div class="ml-20">
                                                                        <div class="text-13">決定地點了嗎?</div>
                                                                        <div class="text-15 lh-1 fw-500">立即搜尋航班</div>
                                                                    </div>
                                                                </div>
                                                            </a>
                                                           
                                                        </div>

                                                    </div>
                                                </div>

                                                <div data-anim-child="slide-up delay-3" class="col-lg-6">
                                                    <iframe id="mapFrame" src="/Customer/Flight/Map" width="100%" height="600px" frameborder="0"></iframe>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </section>
        @* 原本內文 *@

        <section class="layout-pt-md layout-pb-md">
            <div data-anim-wrap class="container">
                <div data-anim-child="slide-up" class="row y-gap-20 justify-between items-end">
                    <div class="col-auto">
                        <div class="sectionTitle -md">
                            <h2 class="sectionTitle__title">推薦航班</h2>
                            <p class=" sectionTitle__text mt-5 sm:mt-0">推薦給你最熱門的遊玩景點</p>
                        </div>
                    </div>
                </div>

                <div id="RecommendFlight" class="row y-gap-30 pt-40 sm:pt-20">
                    @* 推薦航班 *@
                </div>
            </div>
        </section>
    </main>


</body>

@section Scripts {
    <a href="~/lib/bootstrap/dist/js/bootstrap.min.js.map">~/lib/bootstrap/dist/js/bootstrap.min.js.map</a>
    <script src="~/lib/bootstrap/dist/js/bootstrap.min.js"></script>
    <a href="~/lib/jquery/dist/jquery.min.map">~/lib/jquery/dist/jquery.min.map</a>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>

    <script>    
        
        //將資料存進localstorage中
        //localStorage.setItem("abc", JSON.stringify(data));

        // localStorage.setItem("abc", "[{},{}]");



        //打開天氣地圖
        $(document).ready(function () {
            $('#btnMap').click(function () {
                // 設置iframe的src屬性為地圖頁面的URL
                $('#mapFrame').attr('src', '/Customer/Flight/Map');                
                $('#exampleModal').modal('show');
            });
        });

        // Function : 格式化為前端顯示時間
        function formatTime(time) {
            const year = time.getFullYear();
            const month = String(time.getMonth() + 1).padStart(2, '0');
            const day = String(time.getDate()).padStart(2, '0');
            const hour = String(time.getHours()).padStart(2, '0');
            const minute = String(time.getMinutes()).padStart(2, '0');
            const meridiem = hour < 12 ? '上午' : '下午';
            const formattedHour = hour % 12 || 12; // 將小時轉換為12小時制

            return `${year}/${month}/${day} ${meridiem} ${formattedHour}:${minute}`;
        }

        //推薦航班
        const loadRecommendFlight = async () => {
            const RecommendFlight = document.getElementById('RecommendFlight');
            const url = `@Url.Content("~/api/flightapi/GetFlights")`;
            const response = await fetch(url);
            const datas = await response.json();

            // 只篩選前4筆資料
            const top4Datas = datas.slice(0, 4);

            let flightHTML = top4Datas.map(f => {

                // 根據 AirlineId 設置不同圖片
                let imagePath = '';
                if (f.airlineId === 12) {
                    imagePath = `@Url.Content("~/img/airline/eva.jpg")`;
                } else if (f.airlineId === 13) {
                    imagePath = `@Url.Content("~/img/airline/china.jpg")`;
                } else {
                    // 預設圖片
                    imagePath = `@Url.Content("~/img/airline/noimg.png")`;
                }

                // 將分鐘轉為小時分鐘
                const hours = Math.floor(f.duration / 60);
                const minutes = f.duration % 60;
                let timeDisplay = '';

                // 判斷小時分鐘
                if (hours > 0) {
                    timeDisplay = `${hours} 小時`;
                    if (minutes > 0) {
                        timeDisplay += ` ${minutes} 分鐘`;
                    }
                } else {
                    timeDisplay = `${minutes} 分鐘`;
                }

                //加上千分號
                const formattedTicketPrice = f.ticketPrice.toLocaleString();

                //將後端傳回的時間格式轉換
                const departureTime = new Date(f.departureTime);
                const arrivalTime = new Date(f.arrivalTime);
                // 使用 JavaScript 中的 Date 對象的方法來格式化時間
                const formattedDepartureTime = formatTime(departureTime);
                const formattedArrivalTime = formatTime(arrivalTime);


                return `<div data-anim-child="slide-up delay-1" class="col-12">
                                <div class="px-20 py-20 rounded-4 border-light">
                                    <div class="row y-gap-30 justify-between xl:justify-">

                                        <div class="col-xl-8 col-lg-6">
                                            <div class="row y-gap-10 items-center">
                                                <div class="col-sm-auto">
                                                    <img class="size-40" src="${imagePath}" alt="image">
                                                </div>

                                                <div class="col">
                                                    <div class="row x-gap-20 items-end">
                                                        <div class="col-auto">
                                                                            <div class="lh-15 fw-500">${formattedDepartureTime}</div>
                                                            <div class="text-15 lh-15 text-light-1">${f.departure}</div>
                                                        </div>

                                                        <div class="col text-center">
                                                            <div class="flightLine">
                                                                <div></div>
                                                                <div></div>
                                                            </div>
                                                                <div class="text-15 lh-15 text-light-1 mt-10"> ${timeDisplay}</div>
                                                        </div>

                                                        <div class="col-3">
                                                                            <div class="lh-15 fw-500">${formattedArrivalTime}</div>
                                                            <div class="text-15 lh-15 text-light-1">${f.destination}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-auto">
                                            <div class="d-flex items-center">
                                                <div class="text-right mr-24">
                                                            <div class="lh-15 fw-500">NTD ${formattedTicketPrice} 元</div>
                                                </div>
                                                                <a href="@Url.Content("~/Customer/Flight/Booking")" class="button -outline-blue-1 px-30 h-50 text-blue-1">
                                                    前往訂購 <div class="icon-arrow-top-right ml-15"></div>
                                                </a>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>`

            });
            RecommendFlight.innerHTML += flightHTML.join('');
        }

        //填充搜尋欄選項
        //機場
        const loadDeparture = async () => {
            const optDeparture = document.getElementById('optDeparture');

            const url = `@Url.Content("~/api/flightapi/airports")`;
            const response = await fetch(url);
            const datas = await response.json();
            //console.log(datas);
            let departHTLM = datas.map((opt) => {
                return `<div>
                                        <button class="-link d-block col-12 text-left rounded-4 px-20 py-15 js-search-option departure">
                                        <div class="d-flex">
                                        <div class="icon-location-2 text-light-1 text-20 pt-4"></div>
                                        <div class="m-2">
                                        <div class="text-15 lh-12 fw-500 js-search-option-target">${opt}</div>
                                        </div>
                                        </div>
                                        </button>
                                        </div>`
            });
            optDeparture.innerHTML += departHTLM.join('');
        }
        
        const loadDestination = async () => {
            const optDestination = document.getElementById('optDestination');
            const url = '@Url.Content("~/api/flightapi/airports")';
            const response = await fetch(url);
            const datas = await response.json();
            //console.log(datas);
            let destnationHTLM = datas.map((opt) => {
                return `<div>
                                     <button class="-link d-block col-12 text-left rounded-4 px-20 py-15 js-search-option destination">
                                     <div class="d-flex">
                                     <div class="icon-location-2 text-light-1 text-20 pt-4"></div>
                                     <div class="m-2">
                                     <div class="text-15 lh-12 fw-500 js-search-option-target">${opt}</div>
                                     </div>
                                     </div>
                                     </button>
                                     </div>`
            });
            optDestination.innerHTML += destnationHTLM.join('');
        }

        // Function: 將日期格式轉換為後端DateTime格式
        function normalizeDate(dateString) {
            const parts = dateString.split(/\D+/);
            const year = parts[0];
            const month = parts[1].padStart(2, '0');
            const day = parts[2].padStart(2, '0');
            return `${year}-${month}-${day}T00:00:00`;
        }

        
        // //查詢資料
        document.addEventListener("DOMContentLoaded", function () {

            //按下搜尋按鈕，將參數用URL傳到下一頁
            const btnSearch = document.getElementById('btnSearch');
            btnSearch.addEventListener('click', function () {
                
                const txtDeparture = document.getElementById('txtDeparture').value;
                const txtDestination = document.getElementById('txtDestination').value;
                const Adult = parseInt(document.querySelector('.js-count-adult').innerText);
                const Children = parseInt(document.querySelector('.js-count-child').innerText);
                const Baby = parseInt(document.querySelector('.js-count-baby').innerText);
                const DepartureDate = document.querySelector('.js-first-date').innerText;
                const ReturnDate = document.querySelector('.js-last-date').innerText;
                const TicketQty = Adult + Children + Baby;

                let alertMsg = ''; // 初始化警示訊息字串

                //還原警示狀態
                var valiEle = document.getElementsByClassName('validation-message');
                Array.from(valiEle).forEach(ele => { ele.style.display = 'none'; })

                // 檢查任何值是否為 0 或 null，並根據情況更新警示訊息
                if (txtDeparture === '' || txtDeparture === null) {
                    alertMsg += '請選擇出發機場\n';
                    document.getElementById('alertMsgDeparture').innerText = alertMsg;
                    document.getElementById('alertMsgDeparture').style.display = 'block';
                    return
                } else {
                    document.getElementById('alertMsgDeparture').style.display = 'none'; // 隱藏警示訊息
                }

                if (txtDestination === '' || txtDestination === null) {
                    alertMsg += '請選擇目的地機場\n';
                    document.getElementById('alertMsgDestination').innerText = alertMsg;
                    document.getElementById('alertMsgDestination').style.display = 'block';
                    return
                } else {
                    document.getElementById('alertMsgDestination').style.display = 'none'; // 隱藏警示訊息
                }                

                if (DepartureDate === '請選擇日期' || ReturnDate === '請選擇日期') {
                    alertMsg += '請選擇有效的日期';
                    document.getElementById('alertMsgDate').innerText = alertMsg;
                    document.getElementById('alertMsgDate').style.display = 'block';                    
                    return
                } else {
                    document.getElementById('alertMsgDate').style.display = 'none'; // 隱藏警示訊息                    
                }

                if (TicketQty === 0 || Adult===0 ) {
                    alertMsg += '請選擇有效的人數(成人至少1名)';
                    document.getElementById('alertMsgTicketQty').innerText = alertMsg;
                    document.getElementById('alertMsgTicketQty').style.display = 'block';
                    return
                } else {
                    document.getElementById('alertMsgTicketQty').style.display = 'none'; // 隱藏警示訊息
                }

                const FormattedDepartureDate = normalizeDate(document.querySelector('.js-first-date').innerText);
                const FormattedReturnDate = normalizeDate(document.querySelector('.js-last-date').innerText);

                var searchPageUrl = `@Url.Action("Search","Flight",new{area = "Customer"})`
                searchPageUrl += '?Departure=' + txtDeparture + '&Destination=' + txtDestination;
                searchPageUrl += '&DepartureDate=' + FormattedDepartureDate + '&ReturnDate=' + FormattedReturnDate;
                searchPageUrl += '&Adult=' + Adult + '&Children=' + Children + '&Baby=' + Baby;
                //console.log(departureDate);
                //console.log(returnDate);
                console.log(searchPageUrl);
                window.location.href = searchPageUrl;

            });            
        })



        // 處理起飛地選擇事件
        function handleDepartureSelection() {
            var airportName = $(this).find('.js-search-option-target').text();
            //console.log("選擇的起飛地：" + airportName);
            $('#txtDeparture').val(airportName);
        }

        // 處理降落地選擇事件
        function handleDestinationSelection() {
            var airportName = $(this).find('.js-search-option-target').text();
            //console.log("選擇的降落地：" + airportName);
            $('#txtDestination').val(airportName);
        }

        // 使用事件委託綁定點擊事件到靜態的父元素上
        $(document).on('click', '.js-search-option.departure', handleDepartureSelection);
        $(document).on('click', '.js-search-option.destination', handleDestinationSelection);


        //Loading動作
        (async () => {
            await loadDeparture();
            await loadDestination();
            await loadRecommendFlight();
        })()
    </script>

}