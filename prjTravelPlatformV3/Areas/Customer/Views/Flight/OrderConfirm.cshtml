@section Styles {

}
<body>

    <main>
        <div class="masthead__bg" style="position: relative;">
            <img src="~/img/airline/airplane.png" style="filter: brightness(55%); width: 100%; height:320px;" />
            <div class="text-center" style="position: absolute; top:50%; left:50%; transform:translate(-50%, -50%);">
                <h1 class="text-30 fw-600 text-white">訂購資訊</h1>
            </div>
        </div>
        <section class="pt-40">
            <div class="container">
                <div class="row x-gap-40 y-gap-30 items-center">
                    <div class="col-auto">
                        <div class="d-flex items-center">
                            <div class="size-40 rounded-full flex-center bg-blue-1-05 text-blue-1 fw-500">1</div>
                            <div class="text-18 fw-500 ml-10">填寫訂單</div>
                        </div>
                    </div>

                    <div class="col">
                        <div class="w-full h-1 bg-border"></div>
                    </div>

                    <div class="col-auto">
                        <div class="d-flex items-center">
                            <div class="size-40 rounded-full flex-center bg-blue-1-05 text-blue-1 fw-500">2</div>
                            <div class="text-18 fw-500 ml-10">付款</div>
                        </div>
                    </div>

                    <div class="col">
                        <div class="w-full h-1 bg-border"></div>
                    </div>

                    <div class="col-auto">
                        <div class="d-flex items-center">
                            <div class="size-40 rounded-full flex-center bg-blue-1">
                                <i class="icon-check text-16 text-white"></i>
                            </div>
                            <div class="text-18 fw-500 ml-10">完成訂單</div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </section>

        <section class="pt-40 layout-pb-md">
            <div class="container">
                <div class="row">
                    <div id="OrderConfirm" class="col-xl-8 col-lg-8 mx-auto">

                        @* 訂單成立頁面 *@
                        <div class="d-flex flex-column items-center mt-60 lg:md-40 sm:mt-24">
                            <div class="size-80 flex-center rounded-full bg-dark-1">
                                <i class="icon-check text-30 text-white"></i>
                            </div>

                            <div class="text-30 lh-1 fw-600 mt-20">您的訂單已成立!</div>
                            <div class="text-15 text-light-1 mt-10">詳細訂單內容已送至您的信箱: Loading...</div>
                        </div>

                        <div class="border-type-1 rounded-8 px-50 py-35 mt-40">
                            <div class="row">

                                <div class="col-lg-3 col-md-6">
                                    <div class="text-15 lh-12">訂單編號</div>
                                    <div class="text-15 lh-12 fw-500 text-blue-1 mt-10">Loading...</div>
                                </div>

                                <div class="col-lg-3 col-md-6">
                                    <div class="text-15 lh-12">訂單日期</div>
                                    <div class="text-15 lh-12 fw-500 text-blue-1 mt-10">Loading...</div>
                                </div>

                                <div class="col-lg-3 col-md-6">
                                    <div class="text-15 lh-12">總金額</div>
                                    <div class="text-15 lh-12 fw-500 text-blue-1 mt-10">Loading...</div>
                                </div>

                                <div class="col-lg-3 col-md-6">
                                    <div class="text-15 lh-12">付款方式</div>
                                    <div class="text-15 lh-12 fw-500 text-blue-1 mt-10">Loading...</div>
                                </div>

                            </div>
                        </div>

                        <div class="border-light rounded-8 px-50 py-40 mt-40">
                            <h4 class="text-20 fw-500 mb-30">訂購人資料</h4>

                            <div class="row y-gap-10">

                                <div class="col-12">
                                    <div class="d-flex flex-column ">
                                        <div class="text-15 lh-16">訂購會員姓名</div>
                                        <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">Loading...</div>
                                    </div>
                                </div>

                                <div class="col-12">
                                    <div class="d-flex flex-column  border-top-light pt-10">
                                        <div class="text-15 lh-16">電話</div>
                                        <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">Loading...</div>
                                    </div>
                                </div>

                                <div class="col-12">
                                    <div class="d-flex flex-column  border-top-light pt-10">
                                        <div class="text-15 lh-16">電子郵件</div>
                                        <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">Loading...</div>
                                    </div>
                                </div>

                            </div>
                            <h4 class="text-20 fw-500 mt-30 mb-30">行程資料</h4>
                            <div class="row y-gap-10">

                                <div class="col">
                                    <div class="row y-gap-10 items-center mb-3">
                                        <div class="col-sm-auto">
                                            <img class="size-40" src="" alt="image">
                                        </div>

                                        <div class="col-8">
                                            <div class="row x-gap-20 items-end">
                                                <div class="col-auto">
                                                    <div class="lh-15 fw-500" id="departure">Loading...</div>
                                                </div>

                                                <div class="col text-center">
                                                    <div class="flightLine">
                                                        <div></div>
                                                        <div></div>
                                                    </div>
                                                    <div class="text-15 lh-15 text-light-1 mt-10">直達</div>
                                                </div>

                                                <div class="col-auto">
                                                    <div class="lh-15 fw-500" id="destination">Loading...</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>


                                <div class="col-12">
                                    <div class="d-flex flex-column border-top-light pt-10">
                                        <div class="text-15 lh-16">去程</div>
                                        <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">起飛時間：Loading...</div>
                                        <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">降落時間：Loading...</div>
                                    </div>
                                </div>

                                <div class="col-12">
                                    <div class="d-flex flex-column border-top-light pt-10">
                                        <div class="text-15 lh-16">回程</div>
                                        <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">起飛時間：Loading...</div>
                                        <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">降落時間：Loading...</div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="d-flex flex-column border-top-light pt-10">
                                        <div class="text-15 lh-16">乘客資料</div>
                                        <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">乘客姓名：Loading...</div>
                                        <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">性別：Loading...</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
        </section>

    </main>

</body>

@section Scripts {
    <script>

        // 獲取URL參數
        var outgoingScheduleId = sessionStorage.getItem('outgoingScheduleId');
        var returnScheduleId = sessionStorage.getItem('returnScheduleId');
        var orderId = sessionStorage.getItem('orderId');

        // 使用这些数据进行其他操作
        console.log('outgoingScheduleId:', outgoingScheduleId);
        console.log('returnScheduleId:', returnScheduleId);


        //訂單內容加載div
        const OrderConfirm = document.getElementById('OrderConfirm');

        console.log(outgoingScheduleId);

        //DateTime格式化成前端顯示樣式(yyyy/mm/dd tt HH/mm)
        function formatDateTime(dateTimeString) {
            const date = new Date(dateTimeString);
            const formattedDate = `${date.getFullYear()}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getDate().toString().padStart(2, '0')}`;
            const hours = date.getHours();
            const minutes = date.getMinutes();
            const ampm = hours >= 12 ? '下午' : '上午';
            const formattedHours = hours % 12 || 12; // 將小時轉換為 12 小時制

            return `${formattedDate} ${ampm} ${formattedHours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        }

        //顯示訂單內容確認
        const showOrderConfirmPage = async function () {
            try {
                const url = `/api/flightapi/Confirm?outgoingScheduleId=${outgoingScheduleId}&returnScheduleId=${returnScheduleId}&orderId=${orderId}`
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const datas = await response.json();
                console.log(datas);
                console.log(datas.outgoingFlightDetail.fDeparture.fAirport)

                let OrdersHTML = '';

                //訂單日期 格式化成前端顯示樣式
                const formattedOrderDate = formatDateTime(datas.order.fOrderDate).substring(0,10); //只取日期
                //價格加上千分號
                const formattedTotal = (datas.order.fTotal).toLocaleString();
                // 根據 AirlineId 設置不同圖片
                let imagePath = '';
                if (datas.outgoingFlightDetail.fAirline.fId === 12) {
                    imagePath = `@Url.Content("~/img/airline/eva.jpg")`;
                } else if (datas.outgoingFlightDetail.fAirline.fId === 13) {
                    imagePath = `@Url.Content("~/img/airline/china.jpg")`;
                } else {
                    // 預設圖片
                    imagePath = `@Url.Content("~/img/airline/noimg.png")`;
                }
                //去程時間 格式化
                const OutgoingDepartureTime = formatDateTime(datas.outgoingFlightDetail.fDepartureTime);
                const OutgoingArrivalTime = formatDateTime(datas.outgoingFlightDetail.fArrivalTime);
                //回程時間 格式化
                const ReturnDepartureTime = formatDateTime(datas.returnFlightDetail.fDepartureTime);
                const ReturnArrivalTime = formatDateTime(datas.returnFlightDetail.fArrivalTime);
                

                //訂單成立區塊
                OrdersHTML += `<div class="d-flex flex-column items-center mt-60 lg:md-40 sm:mt-24">
                                            <div class="size-80 flex-center rounded-full bg-blue-1">
                                        <i class="icon-check text-30 text-white"></i>
                                    </div>

                                    <div class="text-30 lh-1 fw-600 mt-20">您的訂單已成立!</div>
                                    <div class="text-15 text-light-1 mt-10">詳細訂單內容已送至您的信箱: ${datas.order.fEmail}</div>
                                </div>`
                //訂購人資料
                OrdersHTML += `<div class="border-type-1 rounded-8 px-50 py-35 mt-40">
                                    <div class="row">

                                        <div class="col-lg-3 col-md-6">
                                            <div class="text-15 lh-12">訂單編號</div>
                                            <div class="text-15 lh-12 fw-500 text-blue-1 mt-10">${datas.order.fOrderId}</div>
                                        </div>

                                        <div class="col-lg-3 col-md-6">
                                            <div class="text-15 lh-12">訂單日期</div>
                                                    <div class="text-15 lh-12 fw-500 text-blue-1 mt-10">${formattedOrderDate}</div>
                                        </div>

                                        <div class="col-lg-3 col-md-6">
                                            <div class="text-15 lh-12">總金額</div>
                                                    <div class="text-15 lh-12 fw-500 text-blue-1 mt-10">NTD$${formattedTotal}</div>
                                        </div>

                                        <div class="col-lg-3 col-md-6">
                                            <div class="text-15 lh-12">付款方式</div>
                                            <div class="text-15 lh-12 fw-500 text-blue-1 mt-10">${datas.order.fPayment}</div>
                                        </div>

                                    </div>
                                </div>`
                //行程資料
                OrdersHTML += ` <div class="border-light rounded-8 px-50 py-40 mt-40">
                                    <h4 class="text-20 fw-500 mb-30">訂購人資料</h4>

                                    <div class="row y-gap-10">

                                        <div class="col-12">
                                            <div class="d-flex flex-column ">
                                                <div class="text-15 lh-16">訂購會員姓名</div>
                                                <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">${datas.order.fName}</div>
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <div class="d-flex flex-column  border-top-light pt-10">
                                                <div class="text-15 lh-16">電話</div>
                                                        <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">${datas.order.fPhone}</div>
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <div class="d-flex flex-column  border-top-light pt-10">
                                                <div class="text-15 lh-16">電子郵件</div>
                                                        <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">${datas.order.fEmail}</div>
                                            </div>
                                        </div>

                                    </div>
                                    <h4 class="text-20 fw-500 mt-30 mb-30">行程資料</h4>
                                    <div class="row y-gap-10">

                                        <div class="col">
                                            <div class="row y-gap-10 items-center mb-3">
                                                <div class="col-sm-auto">
                                                            <img class="size-40" src="${imagePath}" alt="image">
                                                </div>

                                                <div class="col-8">
                                                    <div class="row x-gap-20 items-end">
                                                        <div class="col-auto">
                                                              <div class="lh-15 fw-500" id="departure">${datas.outgoingFlightDetail.fDeparture.fAirport}</div>
                                                        </div>

                                                        <div class="col text-center">
                                                            <div class="flightLine">
                                                                <div></div>
                                                                <div></div>
                                                            </div>
                                                            <div class="text-15 lh-15 text-light-1 mt-10">直達</div>
                                                        </div>

                                                        <div class="col-auto">
                                                              <div class="lh-15 fw-500" id="destination">${datas.outgoingFlightDetail.fDestination.fAirport}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>


                                        <div class="col-12">
                                            <div class="d-flex flex-column border-top-light pt-10">
                                                <div class="text-15 lh-16">去程</div>
                                                <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">起飛時間：${OutgoingDepartureTime}</div>
                                                <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">降落時間：${OutgoingArrivalTime}</div>
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <div class="d-flex flex-column border-top-light pt-10">
                                                <div class="text-15 lh-16">回程</div>
                                                        <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">起飛時間：${ReturnDepartureTime} </div>
                                                        <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">降落時間：${ReturnArrivalTime}</div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="d-flex flex-column border-top-light pt-10">
                                                <div class="text-15 lh-16">乘客資料</div>`;
                // 迴圈生成乘客資料區塊
                for (let i = 0; i < datas.outgoingPsgerDetail.length; i++) {
                    //性別轉換成男/女顯示
                    const gender = datas.outgoingPsgerDetail[i].fGender ? '男性' : '女性';

                    OrdersHTML += `<div class="text-15 lh-16 fw-500 text-blue-1 mx-3">乘客${i + 1}</div>
                           <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">乘客姓名：${datas.outgoingPsgerDetail[i].fPsgrName}</div>
                                   <div class="text-15 lh-16 fw-500 text-blue-1 mx-3">性別：${gender}</div>`;
                };
                OrdersHTML += `</div></div></div></div></div>`;

                OrderConfirm.innerHTML = OrdersHTML;

            } catch (error) {
                console.error('fetch發生錯誤:', error);
                // 在這裡處理錯誤，例如顯示錯誤信息給用戶
            }
        }

        document.addEventListener("DOMContentLoaded", function (event) {
            showOrderConfirmPage();
        });


    </script>
}