@model prjTravelPlatform_release.Areas.CustomizedIdentity.DTO.Req.EmpReqDTO

@{
    ViewData["Title"] = "員工登入";
}

@section Styles {
    <style>
        .my-loading {
            z-index: 7700;
            position: fixed;
            top: 50%;
            left: 50%;
            -webkit-transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
            display: none;
        }

        .emp-container {
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
            position: relative;
            overflow: hidden;
            width: 500px;
            max-width: 100%;
            min-height: 480px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 0 20px;
        }

    </style>
}

<div class="emp-container" id="container">

    <form id="empLoginForm">
        <img src="~/img/logof.png" style="width: 300px; height:50px" class="mb-3" />
        <h3 class="mb-3">後台管理系統</h3>
        <!--登入-->
        <input placeholder="帳號" asp-for="Account" />
        <span asp-validation-for="Account" class="ps-2 w-100 text-start text-danger"></span>

        <input type="password" placeholder="密碼" asp-for="Password" />
        <span asp-validation-for="Password" class="ps-2 w-100 text-start text-danger"></span>

        @* <div class="text-end w-100">
        <a href="#">忘記密碼?</a>
        </div> *@



        <button style="margin-top: 20px" id="btnEmpLogin" type="button" onclick="btnEmpLoginClick()">
            <div class="d-flex align-items-center">
                <img id="imgLoading" src="https://localhost:7119/img/frontstage/tube-spinner_w.svg" style="width: 20px; height: 20px; display:none; margin-right:10px" />
                <span>登入</span>
            </div>
        </button>

    </form>

    </<div>

        @section Scripts {
            <script>
                const btnEmpLogin = document.getElementById('btnEmpLogin');
                const imgLoading = document.getElementById('imgLoading');

                const formDataToJson = (formData) => {
                    let obj = {};
                    for (let [key, value] of formData.entries()) {
                        obj[key] = value
                    }
                    return JSON.stringify(obj);
                };

                const btnEmpLoginClick = async () => {

                    imgLoading.style.display = 'block';
                    const formData = new FormData(empLoginForm);

                    const res = await fetch("/api/apilogin/empLogin", {
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: formDataToJson(formData),
                        method: 'POST'
                    });

                    const resData = await res.json();
                    if (resData.success) {

                        imgLoading.style.display = 'none';
                        btnEmpLogin.textContent = '登入成功';

                        setTimeout(() => {
                            window.location.href = "/Employee/Home/Index"
                        }, 1000);

                    } else {

                        if (resData.success === false) {
                            imgLoading.style.display = 'none';
                            Swal.fire({
                                text: resData.message,
                                imageUrl: "https://localhost:7119/img/Hotel/RoomType/delete-button_1.png",
                                heightAuto: false,
                                imageHeight: 80
                            });
                            return;
                        }
                        const errAccount = document.querySelector('[data-valmsg-for="Account"]');
                        const errPassword = document.querySelector('[data-valmsg-for="Password"]');
                        if (resData.errors.Account) {
                            errAccount.textContent = resData.errors.Account[0];
                        }
                        if (resData.errors.Password) {
                            errPassword.textContent = resData.errors.Password[0];
                        }
                    }
                }
            </script>
        }
