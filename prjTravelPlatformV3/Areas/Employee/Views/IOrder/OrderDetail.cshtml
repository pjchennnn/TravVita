@model prjTravelPlatformV3.Models.TIorderDetailView
@{
    ViewData["Title"] = "OrderDetail";
}

@section Styles {
    @* <link href="~/lib/datatables/css/jquery.datatables.css" rel="stylesheet" /> *@
    <style>
        thead {
            background-color: lightslategrey;
            color: black;
        }
    </style>
}


<h1>訂單明細</h1>
<div class="accordion" id="accordionPanelsStayOpenExample">
    <div class="accordion-item">
        <h3 class="accordion-header" id="panelsStayOpen-headingOne">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
                訂單資訊
            </button>
        </h3>
        @* 訂單資訊 *@
        <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
            <div class="accordion-body">
                <table class="table" id="tbOrderInfo">
                    <tbody>
                        <tr>
                            <td>訂單編號:</td>
                            <td id="orderNumber"></td>
                            <td>訂單成立時間:</td>
                            <td id="orderTime"></td>
                        </tr>
                        <tr>
                            <td>會員姓名:</td>
                            <td id="orderName"></td>
                            <td>訂單狀態:</td>
                            <td id="orderStatus"></td>
                        </tr>
                        <!-- 如果需要顯示更多訂單資訊，可以新增更多的 <tr> -->
                        <tr>
                            <td>配送方式:</td>
                            <td id="deliveryMethod"></td>
                            <td>訂單備註:</td>
                            <td id="deliveryMethod"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="accordion-item">
        <h3 class="accordion-header" id="panelsStayOpen-headingTwo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
                商品明細
            </button>
        </h3>
        <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingTwo">
            <div class="accordion-body">
                <table class="table" id="tbOrderDetail">
                    <thead>
                        <tr>
                            <th style="display: none">序號</th>
                            <th style="display: none">訂單編號</th>
                            <th>商品名稱</th>
                            <th>商品規格</th>
                            <th>數量</th>
                            <th>小計</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
    @* 收件人資訊 *@
    <div class="accordion-item">
        <h3 class="accordion-header" id="panelsStayOpen-headingThree">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="false" aria-controls="panelsStayOpen-collapseThree">
                收件人資訊
            </button>
        </h3>
        <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingThree">
            <div class="accordion-body">
                <table class="table" id="tbShipInfo">
                    <tbody>
                        <tr>
                            <td>收件人姓名:</td>
                            <td id="shipName"></td>
                            <td>收件人電話:</td>
                            <td id="shipPhone"></td>
                        </tr>
                        <tr>
                            <td>收件地址:</td>
                            <td id="shipAddress"></td>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        $(document).ready(function () {
            // 獲取傳遞進來的 orderId
            var orderId = '@ViewBag.OrderId'; // 假設您將 orderId 傳遞到視圖中的 ViewBag 中
            console.log(orderId); // 打印到控制台
            // 使用 AJAX 加載訂單資訊
            $.ajax({
                type: 'GET',
                url: `/api/Product/GetOrderById?orderId=${orderId}`,
                success: function (data) {
                    // console.log(data);
                    // 將返回的資料填入對應的 HTML 元素中
                    $('#orderNumber').text(data.fOrderId);
                    $('#orderTime').text(data.fOrderDate);
                    $('#orderName').text(data.fName);
                    $('#orderStatus').text(data.fStatus);
                    $('#deliveryMethod').text(data.fLogisticsName);
                    $('#orderNotes').text(data.fNotes);
                    $('#shipName').text(data.fShipName);
                    $('#shipPhone').text(data.fShipPhone);
                    $('#shipAddress').text(data.fShipAddress);
                },
                error: function () {
                    console.error('Failed to get order info');
                }
            });

            // 使用 AJAX 加載商品明細
            $.ajax({
                type: 'GET',
                url: `/api/Product/GetDetailByOrderId?orderId=${orderId}`,
                success: function (data) {
                    console.log(data);
                    // 遍歷每一筆商品明細資料
                    data.forEach(function (detail) {
                        // 創建一個新的行
                        var newRow = '<tr>';
                        // 添加商品規格、數量和小計到行中
                        newRow += '<td>' + detail.fProductName + '</td>';
                        newRow += '<td>' + detail.fSpecName + '</td>';
                        newRow += '<td>' + detail.fQty + '</td>';
                        newRow += '<td>' + detail.fSubtotal + '</td>';
                        newRow += '</tr>';
                        // 將新的行添加到表格中
                        $('#tbOrderDetail tbody').append(newRow);
                    });
                },
                error: function () {
                    console.error('Failed to get product detail');
                }
            });
        });

    </script>
}